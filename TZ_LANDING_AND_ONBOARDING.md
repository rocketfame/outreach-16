# ТЗ: Лендінг-пейдж та онбординг «шлях користувача»

**Версія:** 1.0  
**Статус:** Для реалізації (нічого не впроваджувати до підтвердження).  
**Мета:** Описати, як подружити лендінг, онбординг («Start creating free» → My Project → Create first project → Create Project → Open Project) і поточну платформу в одному застосунку.

---

## 1. Scope та цілі

### 1.1 Що робимо
- Додати **лендінг-пейдж** як точку входу для нових користувачів.
- Реалізувати **онбординг**: кнопка «Start creating free» → екран «My Project» → «Create first project» → форма створення проєкту → «Create Project» → «Open Project» → перехід на **поточний функціонал платформи** (Project basics, Topic Discovery / Direct Article тощо).

### 1.2 Що не змінюємо на цьому етапі
- Логіку трьалів, Stripe, check-auth, API — лишаємо як є.
- Логіку генерації тем, статтей, зображень, humanize — без змін.
- Існуючий UI платформи (колонки, моди, форми) — лишаємо, тільки «переїжджає» на новий URL.

---

## 2. As-is (поточний стан)

### 2.1 Маршрутизація
- **Один маршрут:** `app/page.tsx` рендериться на **`/`** (корінь).
- Нема окремих сторінок: все в одній сторінці (header, mode tabs, Project basics, topics, articles).
- Нема використання `next/navigation` (useRouter, Link) для внутрішніх переходів.

### 2.2 «Проєкт» зараз
- **Проєкт** у коді = **Project Basics** (Brief: niche, clientSite, language, platform, anchorText, anchorUrl, contentPurpose, wordCount, customStyle) + режим (discovery/direct) + теми + статті.
- Зберігання: **localStorage** під ключем `ucca_state_v1` через `usePersistentAppState`.
- Один «робочий простір» на браузер/пристрій: нема списку проєктів, нема «My Project» / «Open Project».

### 2.3 Що вже є і лишаємо
- `MaintenanceGate`, trial (trial token у URL, trial-usage API), Stripe (create-checkout, webhook), check-auth.
- `usePersistentAppState`: `discoveryProjectBasics`, `directProjectBasics`, `topicClusters`, `discoveryArticles`, `directArticles`, `mode`, тощо.
- Компоненти: CreditsExhausted, UpgradeModal, TrialUsageDisplay, TagPill, LoadingOverlay, Notification тощо.

---

## 3. Цільовий шлях користувача (to-be)

Кроки без змін у бізнес-логіці, тільки навігація та екрани:

1. **Користувач заходить на сайт**  
   - Бачить **лендінг** (головна сторінка): hero, переваги, CTA.

2. **Натискає «Start creating free»**  
   - Перехід на екран **«Get started» / онбординг**.

3. **Екран онбордингу: «My Project»**  
   - Якщо проєктів ще немає: блок «Create first project» (кнопка/картка).
   - Якщо проєкти вже є: список проєктів + кнопка «Create new project» + на кожен проєкт дія **«Open Project»**.

4. **«Create first project» / «Create new project»**  
   - Перехід на форму **створення проєкту**.  
   - Мінімум полів: **назва проєкту** (обов’язково). За бажанням — прев’ю Project Basics (niche, platform), але не обов’язково на першому релізі.

5. **Користувач заповнює й натискає «Create Project»**  
   - Зберігання проєкту (згідно з моделлю даних, див. нижче).  
   - Показ повідомлення типу «Проєкт створено» та кнопка **«Open Project»**.

6. **«Open Project»**  
   - Відкривається **платформа** з уже обраним проєктом: ті самі Project basics, Topic Discovery / Direct Article, теми, статті — тобто поточний функціонал `app/page.tsx`, але з контекстом обраного проєкту.

7. **Далі**  
   - Користувач працює як зараз: заповнює Project basics, шукає теми, генерує статті. При потребі повертається в «My Project» (наприклад, через header/menu) і може вибрати інший проєкт або створити новий.

---

## 4. Роутинг та структура застосунку

### 4.1 Рекомендована структура URL

| URL | Призначення |
|-----|-------------|
| `/` | **Лендінг**: hero, переваги, кнопка «Start creating free». Без логіки платформи. |
| `/start` або `/get-started` | **Онбординг**: «My Project» + «Create first project» / список проєктів + «Open Project», «Create new project». |
| `/project/new` | **Створення проєкту**: форма (назва + за бажанням мінімум полів Basics), кнопка «Create Project». Після успіху — редирект на `/start` з повідомленням «Open Project» або одразу на платформу з новим проєктом. |
| `/app` або `/project/[id]` | **Платформа**: поточний функціонал (те, що зараз у `app/page.tsx`). Рендер Project basics, Topic Discovery / Direct Article, теми, статті. Контекст = обраний проєкт `id` або «поточний» проєкт із стейту. |
| `/account` | **Сторінка акаунта**: профіль, кредити/підписка, налаштування, вихід. Доступна з header платформи та (за бажанням) з `/start`. Детально — розділ 4.3. |

**Рекомендація:**  
- Якщо проєкти ідентифіковані по `id`: використовувати `/app` з query `?project=...` або `/project/[id]`.  
- Якщо на першому етапі лишаємо один «активний» проєкт у фронті: достатньо `/app` і зберігати `currentProjectId` у стейті/URL.

### 4.2 Структура папок (Next.js App Router)

```
app/
  page.tsx              → переписати: редирект "/" на лендінг ОБО рендер лендингу тут; або залишити page.tsx = лендінг
  layout.tsx            → без змін (MaintenanceGate, fonts)
  app/
    page.tsx           → платформа: перенести сюди вміст поточного app/page.tsx
  start/
    page.tsx           → онбординг «My Project» / «Create first project»
  project/
    new/
      page.tsx         → форма «Create project»
    [id]/
      page.tsx         → (опційно) платформа для проєкту id; або завжди /app з id у стейті/query
```

Альтернатива (мінімум змін на старті):

```
app/
  page.tsx             → лендінг (новий контент). За наявності ?from=app або cookie/стейт «вже в апі» — редирект на /app.
  layout.tsx           → без змін
  (dashboard|app)/
    page.tsx           → платформа (переміщений з поточного page.tsx)
  start/
    page.tsx           → онбординг
  project/
    new/
      page.tsx         → Create project
  account/
    page.tsx           → сторінка акаунта
```

У ТЗ зафіксувати вибір варіанту після узгодження (наприклад: «Фаза 1: один домен, `/` = лендінг, `/app` = платформа, `/start`, `/project/new`, `/account`»).

### 4.3 Сторінка акаунта (Account)

**Призначення:** окрема сторінка, де користувач бачить дані свого акаунта, керує підпискою/кредитами та налаштуваннями і може вийти з акаунту.

**URL:** `/account`.

**Місце в навігації:**
- У **header платформи** (`/app`): кнопка/посилання «Account» або іконка аватарки/профілю → `/account`.
- На **`/start`** (опційно): посилання «Account» / «Settings», якщо користувач уже «в системі» (наприклад, має збережені проєкти або trial/user id).
- У **лендингу** — зазвичай не показуємо; або тільки «Sign in» / «Log in», якщо є окрема авторизація.

**Можливий вміст сторінки (за пріоритетом):**

1. **Кредити / використання (обов’язковий мінімум для поточного продукту)**  
   - Поточний баланс кредитів (якщо є API/бекенд).  
   - Для trial: залишок тріалу (аналог того, що показує `TrialUsageDisplay` на платформі).  
   - Кнопка «Upgrade» / «Buy credits» → той самий Upgrade flow (Stripe, модалка або перехід на checkout), що й на платформі.

2. **Підписка / оплата**  
   - Активний план (trial / monthly / yearly тощо), дата продовження.  
   - Історія платежів або посилання на квитанції (якщо це дає Stripe / бекенд).  
   - Керування способом оплати (картка тощо) — за наявності відповідного API.

3. **Профіль (опційно на першому релізі)**  
   - Відображати тільки якщо є повноцінний user account (email, ім’я тощо).  
   - Поля: email, ім’я, опційно аватар. Редагування — за наявності API профілю.

4. **Налаштування**  
   - Тема (light/dark) — можна продублювати з платформи або тягнути з того ж persisted state.  
   - Мова інтерфейсу (якщо планується).  
   - Інші опції, які стосуються всього акаунту, а не одного проєкту.

5. **Вихід (Sign out / Log out)**  
   - Кнопка «Sign out». Поведінка залежить від поточної моделі авторизації:  
     - якщо є сесія/cookie — очистка сесії і редирект на `/` або `/start`;  
     - якщо авторизація лише Basic Auth на весь застосунок — вихід може не бути окремою «сторінкою акаунта», а лише інтегруватися в заголовок; тоді сторінка `/account` орієнтована на кредити/підписку й налаштування.

**Поточний стан (as-is):**  
- Окремої сторінки акаунта **немає**.  
- Є `check-auth` (перевірка, чи налаштований Basic Auth).  
- Є trial (token у URL, trial-usage API), Stripe (checkout, webhook), `TrialUsageDisplay`, `UpgradeModal`, `CreditsExhausted` — все це живе в контексті платформи.  

**Що робити в рамках онбордингу:**  
- Ввести маршрут `/account` і шаблон сторінки.  
- На сторінці в першу чергу показати блок «Кредити / використання» (інтегрувати існуючу логіку trial/balance і кнопку Upgrade).  
- Далі за пріоритетом додати підписку, профіль, налаштування, вихід — залежно від того, чи з’являться user accounts і відповідні API.

**Структура папок:**  
- `app/account/page.tsx` — сторінка акаунта.

**Відкрите для узгодження:**  
- Чи потрібна сторінка акаунта вже на Фазі 1, чи достатньо лише посилання «Account» в header з переходом на заглушку «Coming soon» і кнопкою Upgrade.  
- Який мінімальний набір блоків (кредити / підписка / профіль / вихід) обов’язковий на перший реліз.

---

## 5. Модель даних «проєкт»

### 5.1 Варіант A: тільки фронт (localStorage)

- **Проєкт** = об’єкт `{ id, name, createdAt }` + при відкритті «Open Project» в робочий стейт підвантажується збережений снапшот `AppPersistedState` (або його частина), прив’язаний до `id`.
- **Список проєктів:** масив у localStorage, напр. ключ `ucca_projects_v1`:  
  `[{ id, name, createdAt }, …]`.
- **Стейт по активному проєкту:** окремий ключ на проєкт, напр. `ucca_project_${id}` з повним `AppPersistedState`, або один `ucca_state_v1` відповідає «поточному» проєкту, а при «Open Project» ми перезаписуємо його з вибраного проєкту.
- **Міграція:** існуючий `ucca_state_v1` при першому заході на новий флоу можна трактувати як «дефолтний проєкт» (Default / My first project) і додати його в список проєктів з фіктивним `id`.

Переваги: без бекенду, швидко. Недоліки: нема синку між пристроями, обмеження localStorage.

### 5.2 Варіант B: бекенд (найближчим часом або пізніше)

- Таблиці/колекції: `projects` (id, userId, name, createdAt, …), опційно `project_snapshots` або використання існуючого механізму збереження (якщо уже є).
- Стейт платформи для проєкту завантажується з API при відкритті `/app?project=id` або `/project/[id]`.
- Онбординг і «My Project» роблять запити: list projects, create project, get project.

У ТЗ залишити: «Фаза 1 реалізується з Варіантом A; Варіант B описується як наступний крок після появи backend для проєктів».

---

## 6. Інтеграція з авторизацією та тріалами

- Лендінг **може** бути публічним (без обов’язкового логіну).
- «Start creating free» веде на `/start`. Далі:
  - Якщо є check-auth / обов’язковий логін: на `/start` і далі показувати форму/редирект на логін при неавторизованому користувачу; після логіну — повернення на `/start`.
  - Тріал: якщо вхід через trial-посилання, поведінка залишається як зараз (trial token у URL, перевірки в API). Онбординг і платформа не змінюють виклики trial-usage.
- CreditsExhausted, UpgradeModal, TrialLimitReached викликаються з платформи (`/app`) так само, як сьогодні з `page.tsx`.

Конкретні сценарії (гость vs логін vs trial) краще окремо перелічити в «Прийнятих рішеннях» після узгодження з продуктом.

---

## 7. Етапи реалізації (для виконання по черзі)

### Фаза 1: Роути й лендінг (без зміни логіки платформи)

1. **Роутинг**
   - Додати маршрути: `/` (лендінг), `/start`, `/project/new`, `/app`.
   - Для `/` — новий контент (лендінг); поточний об’ємний UI платформи перенести в `app/(dashboard)/app/page.tsx` або в `app/app/page.tsx`, щоб він рендерився тільки на `/app`.

2. **Лендінг**
   - Реалізувати лендінг на `/`: hero, короткий опис продукту, переваги, одна головна кнопка «Start creating free» → посилання на `/start`.
   - Стилі: у тому ж глобальному потоці (globals.css) або окремі модулі під лендінг, без зміни існуючих класів платформи.

3. **Навігація**
   - У лендингу: посилання на `/start` (наприклад, `next/link`).
   - З `/start` — посилання на `/project/new` та на `/app` (після вибору «Open Project»).
   - У header платформи (`/app`) додати посилання «My Project» → `/start`, щоб повертатися до списку проєктів.

### Фаза 2: Онбординг і «проєкти» (Варіант A, localStorage)

4. **Сторінка `/start`**
   - Якщо список проєктів порожній (localStorage): показ блоку «Create first project» з кнопкою → `/project/new`.
   - Якщо є проєкти: список карток/рядів (назва, дата), на кожній кнопка «Open Project». Плюс кнопка «Create new project» → `/project/new`.
   - При «Open Project» — встановити в стейті (або в окремому контексті) `currentProjectId`, заповнити робочий стейт з `ucca_project_${id}` (або з єдиного снапшота для цього проєкту) і редирект на `/app`.

5. **Модель проєктів (front-only)**
   - Ввести тип `ProjectMeta { id: string; name: string; createdAt: string }`.
   - Список: `ProjectMeta[]` у localStorage `ucca_projects_v1`.
   - Для кожного проєкту зберігати снапшот стейту в `ucca_project_${id}` (повна копія `AppPersistedState` або мінімум необхідного для роботи платформи).
   - При першому відкритті нового флоу: якщо є старий `ucca_state_v1` і немає жодного проєкту — створити один «дефолтний» проєкт з цими даними і записати його в `ucca_projects_v1`, щоб не втратити дані користувача.

6. **Сторінка `/project/new`**
   - Форма: поле «Project name» (обов’язкове), за бажанням — 1–2 поля прев’ю (наприклад, niche або platform).
   - Кнопка «Create Project»:
     - згенерувати `id` (UUID або nanoid),
     - створити `ProjectMeta`, додати в `ucca_projects_v1`,
     - ініціалізувати снапшот стейту для цього `id` (defaultState або копія поточного, якщо прийшли з `/start` з якогось контексту),
     - встановити цей проєкт як поточний,
     - редирект на `/app` з повідомленням типу «Project created», або спочатку на `/start` з toast «Open your new project» і кнопкою «Open Project» (за прийнятим UX).

7. **Платформа `/app`**
   - При завантаженні читати `currentProjectId` з стейту/контексту (або з query `?project=id`). Якщо є — завантажити стейт з `ucca_project_${id}` у `usePersistentAppState` або в провайдер, який живить ту саму структуру даних, що й зараз.
   - При збереженні (наприклад, існуючий useEffect persist у usePersistentAppState) писати не лише в `ucca_state_v1`, а й у `ucca_project_${currentProjectId}` (або повністю перейти на збереження «тільки в проєкт»).
   - Логіка тем/статтей/API лишається без змін; змінюється лише джерело/призначення стейту (один глобальний vs per-project).

### Фаза 3: Полірування й edge cases

8. **Прямі посилання та редиректи**
   - Зайти на `/app` без обраного проєкту → редирект на `/start` з підказкою обрати або створити проєкт.
   - Зайти на `/start` при порожньому списку проєктів → показ лише «Create first project».
   - Після створення першого проєкту з `/project/new` → безпосередній перехід на `/app` з цим проєктом (або спочатку `/start` з одним проєктом у списку — за узгодженим сценарієм).

9. **Header / навігація в платформі**
   - У header на `/app`: логотип/назва продукту (ліворуч), посилання «My Project» (на `/start`), посилання «Account» (на `/account`), по можливості назва поточного проєкту. Не ламати існуючі кнопки (reset, theme, trial display тощо).

10. **Тріали та оплата**
    - Перевірити, що trial-посилання з `?trial=...` коректно відкривають платформу: або лендінг з редиректом на `/app` з збереженням token, або прямий перехід на `/app?trial=...` з онбордингу. Не дублювати логіку trial; лише прокинути query/headers туди, де вже виконуються перевірки.

11. **Сторінка акаунта `/account`**
    - Додати маршрут `app/account/page.tsx`.
    - Мінімум на перший реліз: блок «Кредити / використання» (trial balance або paid balance — перевикористати логіку з `TrialUsageDisplay` / API trial-usage і кнопку Upgrade як на платформі), опційно — вибір теми (light/dark). Пізніше — профіль, підписка, вихід (за наявності user-сесії).
    - У header платформи (`/app`) додати посилання «Account» → `/account`.

### Фаза 4 (опційно): бекенд проєктів

12. Заміна localStorage на API: список проєктів, створення, відкриття, збереження снапшотів — за окремим ТЗ/контрактом API.

---

## 8. Критерії прийняття ( Acceptance criteria )

- Користувач, що зайшов на `/`, бачить лендінг і кнопку «Start creating free»; по кліку потрапляє на `/start`.
- На `/start` при відсутності проєктів показується «Create first project»; по кліку — перехід на `/project/new`.
- На `/project/new` є форма з полем назви проєкту та кнопка «Create Project»; після створення користувач потрапляє на платформу з новим проєктом або спочатку на `/start` з можливістю «Open Project» (згідно з обраним сценарієм у п.7).
- На `/start` при наявності проєктів відображається список проєктів, кнопки «Open Project» та «Create new project». «Open Project» відкриває платформу з обраним проєктом (ті самі дані, теми, статті що збережені для цього проєкту).
- Платформа на `/app` виглядає і поводиться так само, як поточна сторінка на `/` (Topic Discovery, Direct Article, Project basics, генерація, статті, зображення), з тією лише різницею, що контекст прив’язаний до обраного проєкту.
- У платформи є спосіб повернутися до «My Project» (наприклад, посилання в header) без втрати поточного проєкту при наступному відкритті `/app`.
- Існуючий стан у `ucca_state_v1` у користувачів, які вже користувалися продуктом до введення онбордингу, не губиться: він інтерпретується як один «дефолтний» проєкт або мігрується в перший проєкт у списку.
- Тріали, Stripe, CreditsExhausted, UpgradeModal продовжують працювати при роботі з платформою на `/app` так само, як на поточному `/`.
- Є сторінка **Account** на `/account`: доступна з header платформи; мінімум — кредити/використання (trial або paid) і кнопка Upgrade; опційно — тема, профіль, вихід (за наявності user-сесії).

---

## 9. Прийняті рішення та відкриті питання

- **Один домен:** лендінг і платформа на одному домені; окремого домену під лендінг не заводимо на першому етапі.
- **Реалізація проєктів Фаза 1–2:** тільки фронт, localStorage (Варіант A). Бекенд проєктів — окремо (Фаза 4 або пізніше).
- **Відкрите:** чи лендінг і «Start creating free» завжди публічні, чи потрібен логін до натискання «Start creating free» — визначити з продуктом і зафіксувати в цьому документі.
- **Відкрите:** після «Create Project» — одразу відкривати `/app` з новим проєктом чи спочатку показувати `/start` з одним проєктом і кнопкою «Open Project» — зафіксувати після узгодження UX.
- **Сторінка акаунта:** маршрут `/account` і мінімальний вміст (кредити, Upgrade) закладено в ТЗ; питання — чи робити її вже на Фазі 1/2, чи спочатку лише посилання «Account» у header з заглушкою. Мінімум контенту для першого релізу — визначити з продуктом (кредити + Upgrade достатньо як старт).

---

## 10. Файли та посилання для майбутньої реалізації

- Поточний вхід у платформу: `app/page.tsx` (≈7k+ рядків).
- Стейт: `app/hooks/usePersistentAppState.ts`, ключ `ucca_state_v1`.
- Типи: `Brief`, `AppPersistedState`, `Topic`, `GeneratedArticle` у `usePersistentAppState.ts`.
- Глобальні стилі: `app/globals.css`.
- Layout: `app/layout.tsx`, `MaintenanceGate`.
- Тріали / оплата: `CreditsExhausted`, `UpgradeModal`, `TrialUsageDisplay`, API `trial-usage`, `check-auth`, Stripe routes.
- Сторінка акаунта: новий маршрут `app/account/page.tsx`; перевикористати логіку з `TrialUsageDisplay` і `UpgradeModal` для блоку кредитів/Upgrade на `/account`.

Після затвердження ТЗ реалізацію виконувати по фазах 1 → 2 → 3; зміни в коді вносити поетапно, з перевіркою, що поточний функціонал платформи на `/app` повністю зберігається.
